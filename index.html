<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitoring Inkubator Telur Penyu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Slate, Amber & Blue -->
    <!-- Application Structure Plan: Aplikasi ini dirancang sebagai sistem monitoring real-time satu halaman. Struktur informasinya dibagi menjadi: 1) Kontrol Mode (Jantan/Betina/Normal) sebagai input setpoint untuk mikrokontroler. 2) Status Perangkat untuk indikator visual aktuator (Lampu/Kipas). 3) Gauges untuk pembacaan instan suhu dan kelembaban. 4) Grafik Tren interaktif yang mendukung scroll horizontal dengan batas 25 titik data. Struktur ini dipilih agar pengguna bisa melihat data histori yang lebih panjang tanpa membuat grafik terlihat penuh/menumpuk. -->
    <!-- Visualization & Content Choices: 1) Doughnut Chart (Canvas) untuk Gauge Suhu/Kelembaban. 2) Status Indicators (HTML/CSS) untuk ON/OFF aktuator. 3) Line Chart (Canvas) di dalam container scrollable -> Memberikan ruang lebih luas untuk titik data sehingga tidak menumpuk, dengan interaksi tooltip saat titik ditekan. Update dilakukan setiap 5 detik. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #f8fafc;
            color: #1e293b;
        }
        .card {
            background: #ffffff;
            border-radius: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }
        .btn-mode {
            transition: all 0.2s ease;
            border: 2px solid #e2e8f0;
            font-weight: 700;
        }
        .btn-active {
            background-color: #334155;
            color: rgb(243, 0, 0);
            border-color: #334155;
            box-shadow: 0 4px 12px rgba(51, 65, 85, 0.25);
        }
        .gauge-container {
            position: relative;
            width: 100%;
            height: 150px;
        }
        .gauge-text {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.75rem;
            font-weight: 800;
        }
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
        }
        /* Style untuk grafik yang bisa digeser */
        .chart-scroll-container {
            width: 100%;
            overflow-x: auto;
            position: relative;
            scrollbar-width: thin;
            scrollbar-color: #cbd5e1 #f1f5f9;
        }
        .chart-scroll-container::-webkit-scrollbar {
            height: 6px;
        }
        .chart-scroll-container::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        .chart-scroll-container::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 20px;
        }
        .chart-inner-wrapper {
            height: 350px;
            min-width: 100%; /* Akan diperbarui via JS berdasarkan jumlah data */
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-6xl mx-auto">
        
        <!-- Header & Control Buttons -->
        <header class="mb-8 text-center">
            <h1 class="text-2xl md:text-3xl font-bold text-slate-800 mb-6 uppercase tracking-tight">Sistem Monitoring Inkubator</h1>
            <div class="flex flex-wrap justify-center gap-3">
                <button id="btn-jantan" onclick="updateMode('jantan')" class="btn-mode px-6 py-3 rounded-2xl text-sm bg-white hover:border-slate-400">
                    MODE JANTAN (< 27°C)
                </button>
                <button id="btn-betina" onclick="updateMode('betina')" class="btn-mode px-6 py-3 rounded-2xl text-sm bg-white hover:border-slate-400">
                    MODE BETINA (< 30°C)
                </button>
                <button id="btn-normal" onclick="updateMode('normal')" class="btn-mode px-6 py-3 rounded-2xl text-sm bg-white hover:border-slate-400">
                    MODE NORMAL (29°C)
                </button>
            </div>
            <p id="info-status" class="mt-4 text-slate-500 font-medium"></p>
        </header>

        <!-- Main Dashboard Grid -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            
            <!-- Card: Status Perangkat -->
            <div class="card flex flex-col justify-center">
                <h3 class="text-center text-slate-500 font-bold uppercase text-xs tracking-widest mb-6">Status Perangkat</h3>
                <div class="space-y-6 px-4">
                    <div class="flex justify-between items-center">
                        <span class="font-semibold text-slate-600">Lampu Pemanas</span>
                        <div class="flex items-center gap-2">
                            <span id="pemanas-dot" class="status-dot bg-slate-300"></span>
                            <span id="pemanas-label" class="font-bold text-slate-400">OFF</span>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="font-semibold text-slate-600">Kipas Sirkulasi</span>
                        <div class="flex items-center gap-2">
                            <span class="status-dot bg-emerald-500"></span>
                            <span class="font-bold text-emerald-600 uppercase">ON</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Card: Suhu Gauge -->
            <div class="card text-center">
                <h3 class="text-slate-500 font-bold uppercase text-xs tracking-widest mb-4">Suhu Real-Time</h3>
                <div class="gauge-container">
                    <canvas id="canvasTemp"></canvas>
                    <div id="displayTemp" class="gauge-text text-orange-500">--.-°C</div>
                </div>
            </div>

            <!-- Card: Kelembaban Gauge -->
            <div class="card text-center">
                <h3 class="text-slate-500 font-bold uppercase text-xs tracking-widest mb-4">Kelembaban Real-Time</h3>
                <div class="gauge-container">
                    <canvas id="canvasHumid"></canvas>
                    <div id="displayHumid" class="gauge-text text-blue-600">--.-%</div>
                </div>
            </div>

        </div>

        <!-- Section: Tren Data (Scrollable) -->
        <div class="card">
            <h3 class="text-slate-500 font-bold uppercase text-xs tracking-widest mb-4 text-center">Tren Data (Geser untuk Histori)</h3>
            <div id="scrollContainer" class="chart-scroll-container">
                <div id="chartScrollArea" class="chart-inner-wrapper">
                    <canvas id="historyChart"></canvas>
                </div>
            </div>
            <div class="mt-6 flex flex-wrap justify-center gap-8 text-xs font-bold uppercase tracking-wider">
                <div class="flex items-center gap-2 text-orange-500">
                    <div class="w-8 h-1 bg-orange-500 rounded-full"></div> Suhu (°C)
                </div>
                <div class="flex items-center gap-2 text-blue-600">
                    <div class="w-8 h-1 bg-blue-600 rounded-full"></div> Kelembaban (%)
                </div>
            </div>
        </div>

    </div>

    <script>
        // Konfigurasi Target Sesuai Permintaan
        const MODE_SETTINGS = {
            'jantan': { target: 26.5, info: "Menjaga suhu ideal Jantan: < 27.0°C" },
            'betina': { target: 29.5, info: "Menjaga suhu ideal Betina: < 30.0°C" },
            'normal': { target: 29.0, info: "Menjaga suhu ideal Normal: 29.0°C" }
        };

        let currentMode = 'normal';
        let sensorTemp = 25.0; 
        let sensorHumid = 50.0; 
        let labels = [];
        let dataTemp = [];
        let dataHumid = [];
        
        // Batasan data yang ditampilkan diperbarui menjadi 25 titik
        const MAX_POINTS = 25; 

        // Inisialisasi Chart.js Gauges
        const initGauge = (id, color, max) => {
            return new Chart(document.getElementById(id), {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [0, max],
                        backgroundColor: [color, '#f1f5f9'],
                        borderWidth: 0,
                        circumference: 180,
                        rotation: 270,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '85%',
                    plugins: { tooltip: { enabled: false }, legend: { display: false } }
                }
            });
        };

        const gaugeT = initGauge('canvasTemp', '#f97316', 50);
        const gaugeH = initGauge('canvasHumid', '#2563eb', 100);

        // Inisialisasi Grafik Tren
        const ctxTrend = document.getElementById('historyChart').getContext('2d');
        const trendChart = new Chart(ctxTrend, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'Suhu',
                        data: dataTemp,
                        borderColor: '#f97316',
                        backgroundColor: 'rgba(249, 115, 22, 0.05)',
                        borderWidth: 3,
                        pointRadius: 6,
                        pointHoverRadius: 10,
                        pointBackgroundColor: '#f97316',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        tension: 0.4,
                        yAxisID: 'y'
                    },
                    {
                        label: 'Kelembaban',
                        data: dataHumid,
                        borderColor: '#2563eb',
                        backgroundColor: 'rgba(37, 99, 235, 0.05)',
                        borderWidth: 3,
                        pointRadius: 6,
                        pointHoverRadius: 10,
                        pointBackgroundColor: '#2563eb',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        tension: 0.4,
                        yAxisID: 'y1'
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: { mode: 'index', intersect: false },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: 'rgba(15, 23, 42, 0.9)',
                        titleFont: { size: 14, weight: '700' },
                        bodyFont: { size: 14 },
                        padding: 12,
                        displayColors: true,
                        callbacks: {
                            label: (ctx) => ` ${ctx.dataset.label}: ${ctx.parsed.y.toFixed(1)}${ctx.datasetIndex === 0 ? '°C' : '%'}`
                        }
                    }
                },
                scales: {
                    x: { 
                        grid: { display: false }, 
                        ticks: { font: { weight: '600' } }
                    },
                    y: { 
                        type: 'linear', position: 'left', min: 20, max: 40,
                        title: { display: true, text: 'Suhu (°C)', font: { weight: 'bold' } }
                    },
                    y1: { 
                        type: 'linear', position: 'right', min: 20, max: 80,
                        grid: { drawOnChartArea: false },
                        title: { display: true, text: 'Kelembaban (%)', font: { weight: 'bold' } }
                    }
                }
            }
        });

        // Fungsi Ganti Mode
        window.updateMode = (mode) => {
            currentMode = mode;
            document.querySelectorAll('.btn-mode').forEach(b => b.classList.remove('btn-active'));
            document.getElementById(`btn-${mode}`).classList.add('btn-active');
            document.getElementById('info-status').textContent = MODE_SETTINGS[mode].info;
        };

        function mainLoop() {
            const target = MODE_SETTINGS[currentMode].target;
            
            // Logika Kontrol Lampu
            if (sensorTemp < (target - 0.1)) {
                sensorTemp += Math.random() * 0.2;
                document.getElementById('pemanas-dot').className = "status-dot bg-amber-500";
                document.getElementById('pemanas-label').className = "font-bold text-amber-600";
                document.getElementById('pemanas-label').textContent = "ON";
            } else {
                sensorTemp -= Math.random() * 0.08;
                document.getElementById('pemanas-dot').className = "status-dot bg-slate-300";
                document.getElementById('pemanas-label').className = "font-bold text-slate-400";
                document.getElementById('pemanas-label').textContent = "OFF";
            }

            // Simulasi Kelembaban
            sensorHumid += (Math.random() - 0.5) * 0.6;
            if (sensorHumid < 40) sensorHumid += 0.5;
            if (sensorHumid > 60) sensorHumid -= 0.5;

            // Update Teks & Gauges
            document.getElementById('displayTemp').textContent = `${sensorTemp.toFixed(1)}°C`;
            document.getElementById('displayHumid').textContent = `${sensorHumid.toFixed(1)}%`;
            
            gaugeT.data.datasets[0].data = [sensorTemp, 50 - sensorTemp];
            gaugeT.update('none');
            
            gaugeH.data.datasets[0].data = [sensorHumid, 100 - sensorHumid];
            gaugeH.update('none');

            // Update Grafik Tren
            const timestamp = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            
            // Batasi data historis menjadi 25 titik
            if (labels.length >= MAX_POINTS) {
                labels.shift();
                dataTemp.shift();
                dataHumid.shift();
            }
            
            labels.push(timestamp);
            dataTemp.push(sensorTemp);
            dataHumid.push(sensorHumid);

            // Dynamically adjust the width of the chart to prevent overlapping
            const pointSpacing = 60; // Sedikit lebih renggang karena hanya 25 titik
            const scrollArea = document.getElementById('chartScrollArea');
            const calculatedWidth = labels.length * pointSpacing;
            
            // Hanya buat lebar bertambah jika melebihi lebar kontainer aslinya
            if (calculatedWidth > scrollArea.parentElement.offsetWidth) {
                scrollArea.style.width = calculatedWidth + 'px';
            } else {
                scrollArea.style.width = '100%';
            }

            trendChart.update('none');

            // Auto-scroll ke paling kanan agar data terbaru terlihat
            const container = document.getElementById('scrollContainer');
            container.scrollLeft = container.scrollWidth;
        }

        updateMode('normal');
        // Interval diperbarui menjadi 5 detik (5000ms)
        setInterval(mainLoop, 5000); 
    </script>
</body>
</html>
